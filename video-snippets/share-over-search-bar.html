<style>
@font-face {
    font-family: 'fontello-{{ snippet_id }}';
    src: url('data:application/octet-stream;base64,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') format('woff');
    font-weight: normal;
    font-style: normal;
}

#share-video-snippet-{{ snippet_id }} {
    width: 480px;
    margin: 0 auto;
    display: inline-block;
    text-align: start;
    margin: 12px 0;
    font-size: 75%;
    border-radius: 2.5px;
}

#share-video-snippet-{{ snippet_id }} .message {
    display: block;
    padding: 20px 10px 20px 20px;
    font-size: 14px;
    line-height: 18px;
    width: 330px;
    transition: opacity 0.3s ease-out;
    opacity: 1;
}

#share-video-snippet-{{ snippet_id }} .message .post-share {
    display: none;
}

#share-video-snippet-{{ snippet_id }} .strings {
    display: none;
}

#share-video-snippet-{{ snippet_id }} .social {
    width: 38px;
    height: 38px;
    display: inline-block;
    margin-right: 15px;
    border: 1px solid rgba(23, 147, 229, 1);
    box-shadow: 0px 0px 1px rgba(0,0,0,0.25),
    inset 0px 1px 0px rgba(255,255,255,0.4);
    background-color: rgba(255,255,255,0);
    border-radius: 4px;
}

#share-video-snippet-{{ snippet_id }} .social:hover {
    box-shadow: 0px 2px 2px rgba(0,0,0,0.2),
    inset 0px 1px 0px rgba(255,255,255,0.4),
    inset 0px 1px 12px rgba(255,255,255,0.3);
    background-color: rgba(255,255,255,0.2);
    transition-property: background-color, box-shadow;
    transition-duration: 0.1s;
    transition-timing-function: ease-out;
}

#share-video-snippet-{{ snippet_id }} .social:active {
    box-shadow: inset 0px 2px 2px rgba(0,0,0,0.4),
    inset 0px -1px 0px rgba(255,255,255,0.4);
    background-color: rgba(0,0,0,0.1);
    border: 1px solid rgba(23, 147, 229, 0);
    transition-property: background-color, box-shadow;
    transition-duration: 0.1s;
    transition-timing-function: ease-out;
}

#share-video-snippet-{{ snippet_id }} .fb {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAQAAAAm93DmAAAA7ElEQVR4Ae3WoW3FMBDGcYPCB0LLAh73Bp2gC0QlHaEjFERdILQDOLgTGGWE4PLK4FFL+VcKsOpEV9V2KgX4+1B00k9KDuTU6VODxuD4WxwGjYobP3Z40uLpZFCncYHUEmjIi5FAx+/54pMb+zgJlDPzRINae+EBS5xEcOKCijqUgAtX1KYfJaBF7TqXgAMq9I13el7wJWAf5veElICvYd6Wg4+0NGF+R7tW579ywDZdjgUbOBa85oMTlucfW7Zr53/ccgUr6DJBJ4EmExyR/8sZoEenXQ4yKFwOcTXj5lv2IugY5dsmvxU8P/gNqXzv26a5D3AAAAAASUVORK5CYII="), linear-gradient(rgba(76, 177, 255, 1), rgba(23, 147, 229, 1));
    background-size: 40px auto;
    background-position: center center;
    background-repeat: no-repeat;
    cursor: pointer;
    transform: scale(0.95);
}

#share-video-snippet-{{ snippet_id }} .fb:hover {
    transform: scale(1);
    transform: translateY(-1px);
    transition-property: transform;
    transition-duration: 0.1s;
    transition-timing-function: ease-out;
}

#share-video-snippet-{{ snippet_id }} .twitter {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAMAAAC7IEhfAAAAYFBMVEUAAAD///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////98JRy6AAAAHnRSTlMAtmD57NfgHAr8BYOUVOUTfM8qPfOLnUeoxMIkbzfVn4SqAAAAyElEQVQYGe3BR3LDMBAEwCEymDMVa/7/S5ccigC5PuqmbuDjjbrFRT08AuArj9TdjdhNht+suujokVrY3vFnnLmrn0hdSTPhV8GEbpGyJGNf4sUzFTekbnxxqgTQMBEVMhV/mLXxiokGOa8pG5EpraHMI6cpiyVyN8osDhrKahwVFG04CgUFbYkTS0GPs4pnJuAsWJ4oSLzlwQWy8HBMDQGy5xqZGDqc1fVatMwUAYJKM2cUZH6ZuXN9h3+Frb6ayNkV1YSPd/kCAwozo8pJSGgAAAAASUVORK5CYII="), linear-gradient(rgba(76, 177, 255, 1), rgba(23, 147, 229, 1));
    background-size: 40px auto;
    background-position: center center;
    background-repeat: no-repeat;
    cursor: pointer;
    transform: scale(0.95);
}

#share-video-snippet-{{ snippet_id }} .twitter:hover {
    transform: scale(1);
    transform: translateY(-1px);
    transition-property: transform;
    transition-duration: 0.1s;
    transition-timing-function: ease-out;
}

#share-video-snippet-{{ snippet_id }} .snippet-box {
    position: relative;
    background-color: rgba(255,255,255,0);
    opacity:1;
    background-position: 65%;
    box-shadow: 0px 1px 1.5px rgba(0,0,0,0.15),
    inset 0px 1px 0px rgba(255,255,255,1);
    display: flex;
    align-items: center;
    transform: scale(1);
}

#share-video-snippet-{{ snippet_id }} .snippet-box:hover {
    background-color: rgba(255,255,255,0.4);
}

#logo-replacement-{{ snippet_id }} {
    position: relative;
    top: 0px;
    left: 10px;
    margin: 22px auto 0 auto;
    width: 666px;
    height: 0;
    overflow: visible;
    pointer-events: none;
    opacity: 0;
    display: none;
}

#logo-replacement-{{ snippet_id }}.show {
    display: block;
    opacity: 1;
    height: 310px;
}

#logo-replacement-{{ snippet_id }} .video-container {
    width: 480px;
    position: absolute;
    left: 90px;
    top: 15px;
}

#logo-replacement-{{ snippet_id }} .video-container video {
    pointer-events: all;
    cursor: pointer;
    width: 480px;
    height: 270px;
}

#logo-replacement-{{ snippet_id }} .video-container video.played {
    cursor: auto;
}

#logo-replacement-{{ snippet_id }} .video-overlay {
    position: absolute;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
}

#logo-replacement-{{ snippet_id }} .video-overlay .button {
    display: none;
    cursor: pointer;
    background: none;
    border: 0;
    color: #FFF;
    font-weight: bold;
    font-size: 16px;
    letter-spacing: -.05em;
    text-transform: uppercase;
    text-align: center;
    margin: 75px auto 0;
}

#logo-replacement-{{ snippet_id }} .replay {
    pointer-events: auto;
}

#logo-replacement-{{ snippet_id }} .video-overlay .button.show {
    display: block;
}

#logo-replacement-{{ snippet_id }} .video-overlay .button::before {
    display: block;
    color: #FFF;
    cursor: pointer;
    line-height: 100px;
    font-size: 42px;
    text-align: center;
    margin: 0 auto 20px;
    border-radius: 50%;
    background: #0C99D5;
    border: 3px solid #B2E5FB;
    height: 94px;
    width: 94px;
    transition: all 0.2s ease;
    font-family: fontello-{{ snippet_id }};
}

#logo-replacement-{{ snippet_id }} .replay::before {
    content: '\e800';  /* Replay icon */
}

#logo-replacement-{{ snippet_id }} .play::before {
    content: '\e801';  /* Play icon */
}
</style>

<div id="share-video-snippet-{{ snippet_id }}" class="snippet">
  <div class="strings" data-tweet-text="{{ tweet_text|escape }}" data-tweet-hashtag="{{ tweet_hashtag|escape }}"></div>
  <div id="logo-replacement-{{ snippet_id }}">
    <div class="video-container">
      <div class="video-overlay">
        <button class="button replay"></button>
        <button class="button play show"></button>
      </div>
      <video poster="{{ video_poster }}" src="{{ video_url }}" />
    </div>
  </div>

  <div class="snippet-box">
    <div class="message">
        <span class="pre-share">{{ message|safe }}</span>
        <span class="post-share">{{ postShareMessage|safe }}</span>
    </div>
    <div class="social-container">
      <span class="social fb"></span>
      <span class="social twitter"></span>
    </div>
  </div>
</div>

<script>
//<![CDATA[
(function() {
    'strict';

    var videoVisible = false;

    var snippet = document.getElementById('share-video-snippet-{{ snippet_id }}');
    var logoContainer = document.getElementById('brandLogo');
    var topContainer = document.getElementById("topSection");
    var snippetBox = snippet.querySelector('.snippet-box');
    var message = snippet.querySelector('.message');
    var stringElement = snippet.querySelector('.strings');
    var logoReplacement = document.getElementById('logo-replacement-{{ snippet_id }}');
    var video = logoReplacement.querySelector('video');
    var replay = logoReplacement.querySelector('.replay');

    function getString(id) {
        return stringElement.dataset[id];
    }

    snippet.addEventListener('show_snippet', function(e) {
        // Fade out logo and insert animation.
        logoContainer.style.opacity = 1;
        logoContainer.style.transitionProperty = 'opacity';
        logoContainer.style.transitionDuration = '400ms';
        logoContainer.style.opacity = 0;
        topContainer.insertBefore(logoReplacement, topContainer.firstChild);

        // Once the logo fades out, show the video.
        logoContainer.addEventListener('transitionend', function() {
            topContainer.removeChild(logoContainer);
            logoReplacement.classList.add('show');
            videoVisible = true;
        });
    });

    video.addEventListener('click', function() {
        logoReplacement.querySelector('.play').classList.remove('show');
        video.play();
        video.controls = 'controls';
        video.classList.add('played');
    });

    // Track when the video is first played.
    var hasPlayed = false;
    video.addEventListener('playing', function() {
        if (!hasPlayed) {
            hasPlayed = true;
            sendMetric('share-video-play');
        }

        replay.classList.remove('show');
    });

    // Track progress through the video.
    var lastProgress = 0;
    var thresholds = [0.25, 0.5, 0.75, 1];
    video.addEventListener('timeupdate', function() {
        var currentProgress = video.currentTime / video.duration;
        if ((currentProgress > lastProgress && !video.paused) || currentProgress == 1) {
            for (var k = 0; k < thresholds.length; k++) {
                var threshold = thresholds[k];
                if (lastProgress < threshold && threshold <= currentProgress) {
                    sendMetric('simple-video-threshold-' + threshold);
                    break;
                }
            }
        }
        lastProgress = currentProgress;
    });

    // Show replay button when the video ends.
    video.addEventListener('ended', function() {
        replay.classList.add('show');
    });

    // Replay video when replay is clicked.
    replay.addEventListener('click', function() {
        sendMetric('share-video-replay');
        video.play();
    });

    function postShare() {
        if (!postShare.runOnce) {
            message.style.opacity = 0;
            afterEvent(message, 'transitionend', function() {
                message.querySelector('.pre-share').style.display = 'none';
                message.querySelector('.post-share').style.display = 'inline';
                message.style.opacity = 1;
            });
        }
        postShare.runOnce = true;
    }
    postShare.runOnce = false;

    function afterEvent(element, eventName, callback) {
        function oneTimeCallback(e) {
            element.removeEventListener(eventName, oneTimeCallback);
            callback.call(this, e);
        }

        element.addEventListener(eventName, oneTimeCallback);
    }

    var FACEBOOK_APPID = encodeURIComponent('307233949472123');
    var HREF_FB = encodeURIComponent('{{ facebook_share_url|replace('&amp;', '&')|safe }}');
    var HREF_TW = encodeURIComponent('{{ twitter_share_url|replace('&amp;', '&')|safe }}');
    var REDIRECT_URL = encodeURIComponent('https://snippets.mozilla.com/static/html/close.html');
    var TWITTER_TEXT = encodeURIComponent(getString('tweetText'));
    var TWITTER_HASHTAG = encodeURIComponent(getString('tweetHashtag'));
    var DIALOG_WINDOW_NAME = 'share_window';
    var DIALOG_DIMENSIONS = 'height=400,width=500';

    var facebook_url = ('https://www.facebook.com/dialog/feed?app_id=' +
                        FACEBOOK_APPID + '&display=popup&link=' + HREF_FB +
                        '&redirect_uri=' + REDIRECT_URL);
    var twitter_url = ('https://twitter.com/share?url=' + HREF_TW +
                       '&original_referer=' + HREF_TW + '&text=' +
                       TWITTER_TEXT + '&hashtags=' + TWITTER_HASHTAG);

    function showShareDialog(url) {
        var dialog_obj = window.open(url, DIALOG_WINDOW_NAME, DIALOG_DIMENSIONS);
        var dialog_interval_id = window.setInterval(function () {
            if (dialog_obj == null || dialog_obj.closed){
                postShare();
                window.clearInterval(dialog_interval_id);
            }
        }, 100);
    }

    // Facebook click
    snippet.querySelector('.fb').onclick = function(){
        sendMetric('share-video-fb-click');
        showShareDialog(facebook_url);
    }

    // Twitter click
    snippet.querySelector('.twitter').onclick = function(){
        sendMetric('share-video-twitter-click');
        showShareDialog(twitter_url);
    }
})();
//]]>
</script>
